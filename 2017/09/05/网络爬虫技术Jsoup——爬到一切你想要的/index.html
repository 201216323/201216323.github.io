<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>网络爬虫技术Jsoup——爬到一切你想要的 | 常灿光个人博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">网络爬虫技术Jsoup——爬到一切你想要的</h1><a id="logo" href="/.">常灿光个人博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">网络爬虫技术Jsoup——爬到一切你想要的</h1><div class="post-meta">Sep 5, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><blockquote>
<p>本文由我的微信公众号（bruce常）原创首发，<br>并同步发表到csdn博客，欢迎转载，2016年12月11日。</p>
</blockquote>
<h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><p>本周五，接到一个任务，要使用爬虫技术来获取某点评网站里面关于健身场馆的数据，之前从未接触过爬虫技术，于是就从网上搜了一点学习资料，本篇文章就记录爬虫技术Jsoup技术，爬虫技术听名称很牛叉，其实没什么难点，慢慢的用心学习就会了。</p>
<h3 id="Jsoup介绍："><a href="#Jsoup介绍：" class="headerlink" title="Jsoup介绍："></a>Jsoup介绍：</h3><p>Jsoup 是一个 Java 的开源HTML解析器，可直接解析某个URL地址、HTML文本内容，Jsoup官网jar包<a href="https://jsoup.org/download" target="_blank" rel="external">下载地址</a>。</p>
<p>Jsoup主要有以下功能：</p>
<ol>
<li>从一个URL，文件或字符串中解析HTML</li>
<li>使用DOM或CSS选择器来查找、取出数据</li>
<li>对HTML元素、属性、文本进行操作</li>
<li>清除不受信任的HTML (来防止XSS攻击)</li>
</ol>
<h3 id="使用Jsoup爬虫技术你需要的能力有："><a href="#使用Jsoup爬虫技术你需要的能力有：" class="headerlink" title="使用Jsoup爬虫技术你需要的能力有："></a>使用Jsoup爬虫技术你需要的能力有：</h3><ol>
<li>我们是用安卓开发的，首先肯定要有一定的安卓开发能力，会写简单的页面。</li>
<li>Jsoup中用到了Javascript语言，没有此语言能力在获取数据的时候就比较吃力，这是此爬虫技术的重中之重。</li>
<li>查阅文档与解决问题的能力和技巧（有点废话）</li>
</ol>
<p>上面三条中对于一个安卓开发者来说，最难的就是熟练使用Javascript语言，小编就遇到了这个问题，小编还有一定的javascript基础，系统的学习过此语言，但是在使用中还是很吃力的，问同学、问朋友、问同事，最后还是靠自己来获取自己想要的数据。</p>
<h3 id="爬虫技术没那么难，思路就是这么的简单"><a href="#爬虫技术没那么难，思路就是这么的简单" class="headerlink" title="爬虫技术没那么难，思路就是这么的简单"></a>爬虫技术没那么难，思路就是这么的简单</h3><ol>
<li>得到自己想要爬取数据的url.</li>
<li>通过Jsoup的jar包中的方法将Html解析成Document，</li>
<li>使用Document中的一些列get、first、children等方法获取自己想要的数据，如图片地址、名称、时间。</li>
<li>将得到的数据封装成自己的实体类。</li>
<li>将实体中的数据在页面加载出来。</li>
</ol>
<h3 id="实战，获取-点评网站中的场馆数据："><a href="#实战，获取-点评网站中的场馆数据：" class="headerlink" title="实战，获取**点评网站中的场馆数据："></a>实战，获取**点评网站中的场馆数据：</h3><h6 id="先奉上效果图，没有图不说话："><a href="#先奉上效果图，没有图不说话：" class="headerlink" title="先奉上效果图，没有图不说话："></a>先奉上效果图，没有图不说话：</h6><p><img src="http://a4.qpic.cn/psb?/V10Llwbb1wSOar/COp7gE.LCkWeebjFo0FHzIvXONixFaqsOQsBICE2WVE!/b/dGcBAAAAAAAA&amp;ek=1&amp;kp=1&amp;pt=0&amp;bo=TgFeAk4BXgICCCw!&amp;tm=1481464800&amp;sce=0-12-12&amp;rf=0-18" alt="image"></p>
<p>这就是今天要实现的效果，左边图片是场馆的logo，右边上方是场馆的名称，下边是场馆的地址信息，点击进去可以根据超链接地址跳转新的页面，页面的Url地址小编已经拿到，但可能是因为重定向的问题，webview没有加载出来，有兴趣的可以输入链接地址来验证。</p>
<h4 id="首先：新建一个空的项目"><a href="#首先：新建一个空的项目" class="headerlink" title="首先：新建一个空的项目."></a>首先：新建一个空的项目.</h4><p>上面的效果，只要接触过安卓开发的都能写出来，所以不是本篇文章的重点，这里就不过多说明，大家可以使用ListView或者RecyclerView来实现，我这里用ListView。</p>
<p>小编这里是为了加入侧边栏所以使用的是DrawerLayout，但后来没有用到，所以也就没有侧边栏的效果，不过后期如有时间会加上去的，上一页下一页是为了简单的模仿浏览器中的操作，此效果只能显示前9页数据，网页链接中有50页的数据，为什么没有实现呢？</p>
<p>很简单，因为50页的链接地址不是一次性返回的，小编为了方便，只获取了前9页数据的url，毕竟是为了抓取数据显示而已。</p>
<h4 id="其次：主程序设计"><a href="#其次：主程序设计" class="headerlink" title="其次：主程序设计"></a>其次：主程序设计</h4><ol>
<li>通过网页得到**点评健身场馆的url地址是：<a href="http://www.dianping.com/search/category/2/45" target="_blank" rel="external">http://www.dianping.com/search/category/2/45</a></li>
<li>抓取数据是一个耗时的操作，需要在一个线程中完成，这里使用 new Thread(runnable).start()方式，在runnable代码中获取场馆的logo、名称、地址如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Runnable runnable = new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            Connection conn = Jsoup.connect(url);</div><div class="line">            // 修改http包中的header,伪装成浏览器进行抓取</div><div class="line">            conn.header(&quot;User-Agent&quot;, userAgent);</div><div class="line">            Document doc = null;</div><div class="line">            try &#123;</div><div class="line">                doc = conn.get();</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            //获取场馆的数据</div><div class="line">            Element elementDiv = doc.getElementById(&quot;shop-all-list&quot;);</div><div class="line">            Elements elementsUl = elementDiv.getElementsByTag(&quot;ul&quot;);</div><div class="line">            Elements elements = elementsUl.first().getElementsByTag(&quot;li&quot;);</div><div class="line">            for (Element element : elements) &#123;</div><div class="line">                Elements elements1 = element.children();</div><div class="line">                String targetUrl = elements1.get(0).getElementsByTag(&quot;a&quot;).attr(&quot;href&quot;);</div><div class="line"></div><div class="line">                String img = elements1.get(0).getElementsByTag(&quot;img&quot;).first().attr(&quot;data-src&quot;);</div><div class="line">                if (img.contains(&quot;.jpg&quot;)) &#123;</div><div class="line">                    int a = img.indexOf(&quot;.jpg&quot;);</div><div class="line">                    img = img.substring(0, a + 4);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                String radiumName = elements1.get(1).child(0).getElementsByTag(&quot;h4&quot;).text();</div><div class="line">                String address0 = elements1.get(1).child(2).getElementsByTag(&quot;a&quot;).get(1).text();</div><div class="line"></div><div class="line">                String address1 = elements1.get(1).child(2).getElementsByClass(&quot;addr&quot;).text();</div><div class="line"></div><div class="line">                RadiumBean radiumBean = new RadiumBean();</div><div class="line">                radiumBean.setImg(img);</div><div class="line">                radiumBean.setName(radiumName);</div><div class="line">                radiumBean.setAddress(address0 + &quot; &quot; + address1);</div><div class="line">                list.add(radiumBean);</div><div class="line">            &#125;</div><div class="line">            // 执行完毕后给handler发送一个空消息</div><div class="line">            Message message = new Message();</div><div class="line">            message.arg1 = Integer.parseInt(curPage);</div><div class="line">            handler.sendMessage(message);</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<ol>
<li>通过Jsoup.connect()方法，根据目标地址url来得到Connection对象，</li>
<li>将我们的app伪装成浏览器，防止人家后台发现我们在爬取人家的数据，这需要修改修改http包中的header，来设置User-Agent，此值可以在谷歌浏览器中输入“about:version”来查看，也可以访问此<a href="http://www.966266.com/jishu/user-agent-chaxun.html" target="_blank" rel="external">地址查看</a>。</li>
<li>通过Connection对象的get()方法来获得整个页面源代码所在的Document</li>
<li>通过分析源代码，使用Document的对象来得到我们想要的数据，上面程序中img待变场馆logo的url，radiumName是小编得到的场馆的名称，address0和address1是小编得到的场馆地址的信息，这里通过组合来使用。</li>
<li>构造我们ListView所用到的数据</li>
<li>通过Handle来更新页面信息，curPage（当前页）稍后说明。</li>
</ol>
</blockquote>
<ol>
<li>在得到数据后页面加载显示<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (!list.isEmpty()) &#123;</div><div class="line">            MyAdapter adapter = new MyAdapter(list, MainActivity.this);</div><div class="line">            info_list_view.setAdapter(adapter);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>4.点击跳转到场馆的详情页，这里本想用Webview加载的，但是可能是网页重定向的问题，webview也能加载出来，但一会就显示无法连接网络，所以场馆详情页就显示出了我们得到的场馆详情页的url。</p>
<p>基本的抓取数据、加载数据流程就是这样的，但是仅仅靠上面的数据还是不能完全实现我们的效果的。</p>
<h3 id="完善页面，实现上下页翻页功能。"><a href="#完善页面，实现上下页翻页功能。" class="headerlink" title="完善页面，实现上下页翻页功能。"></a>完善页面，实现上下页翻页功能。</h3><ol>
<li>页面在爬取数据的时候显示一个ProgressDialog来提示用户。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ProgressDialog dialog = new ProgressDialog(this);</div><div class="line">            dialog.setMessage(&quot;正在抓取数据...&quot;);</div><div class="line">            dialog.setCancelable(false);</div><div class="line">            dialog.show();</div></pre></td></tr></table></figure>
<p>数据加载完毕，关闭此dialog。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dialog.dismiss();</div></pre></td></tr></table></figure>
<p>2.ProgresDialog加载前做是否有网络的判断，有网的时候才显示ProgressDialog，无网络的时候给出提示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public boolean isNetworkAvailable(Activity activity) &#123;</div><div class="line">       Context context = activity.getApplicationContext();</div><div class="line">       ConnectivityManager cm = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);</div><div class="line">       if (cm == null)</div><div class="line">           return false;</div><div class="line">       else &#123;   // 获取所有NetworkInfo对象</div><div class="line">           NetworkInfo[] networkInfo = cm.getAllNetworkInfo();</div><div class="line">           if (networkInfo != null &amp;&amp; networkInfo.length &gt; 0) &#123;</div><div class="line">               for (int i = 0; i &lt; networkInfo.length; i++)</div><div class="line">                   if (networkInfo[i].getState() == NetworkInfo.State.CONNECTED)</div><div class="line">                       return true;  // 存在可用的网络连接</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       return false;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>3.完善runnable，抓取当前页码、上一页、下一页的链接地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// 获取页数的链接</div><div class="line">            if (firstLoad) &#123;</div><div class="line">                Elements elementsPages = doc.getElementsByClass(&quot;content-wrap&quot;);</div><div class="line">                Elements elementsPageA = elementsPages.first().getElementsByClass(&quot;shop-wrap&quot;).first().child(1).getElementsByTag(&quot;a&quot;);</div><div class="line">                for (int i = 0; i &lt; elementsPageA.size() - 2; i++) &#123;</div><div class="line">                    Element element = elementsPageA.get(i);</div><div class="line">                    Element element1 = element.getElementsByClass(&quot;cur&quot;).first();</div><div class="line">                    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</div><div class="line">                    if (element1 != null) &#123;</div><div class="line">                        curPage = element1.text();</div><div class="line">                        map.put(&quot;page&quot;, &quot;&quot; + (i + 1));</div><div class="line">                        map.put(&quot;url&quot;, url);</div><div class="line">                        mMapList.add(map);</div><div class="line">                    &#125; else &#123;</div><div class="line">                        map.put(&quot;page&quot;, &quot;&quot; + (i + 1));</div><div class="line">                        map.put(&quot;url&quot;, element.attr(&quot;href&quot;));</div><div class="line">                        mMapList.add(map);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            firstLoad = false;</div></pre></td></tr></table></figure>
<p>因为在网页中，第一次进入返回了前9页和第50页的数据，这里只取前9页的数据，firstLoad代表第一次加载，mMapList用来存放页码和页面跳转时候的url，对js中的代码不明白的朋友们，要好好学学js，这里小编就不介绍js了，至于我为什么知道取这些字段，那是小编盯着网页源程序代码看了半天看出来的。</p>
<ol>
<li>这个时候就用到了之前runnable中的Message对象中的curPage</li>
</ol>
<p>curPage代表当前页码，从1开始………………在handle接收到消息后显示此页码信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tvCurrentPage.setText(&quot;&quot; + msg.arg1);</div></pre></td></tr></table></figure>
<ol>
<li>模仿网页的上一页下一页，我们需要处理TextView的点击事件。</li>
</ol>
<p>下一页事件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if (curPage.equals(&quot;&quot; + (mMapList.size()))) &#123;</div><div class="line">                    Toast.makeText(this, &quot;末页&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">                &#125; else &#123;</div><div class="line">                    curPage = &quot;&quot; + (Integer.parseInt(curPage) + 1);</div><div class="line">                    url = &quot;http://www.dianping.com&quot; + mMapList.get(Integer.parseInt(curPage) - 1).get(&quot;url&quot;).toString();</div><div class="line">                    switchOver();</div><div class="line">                    tvCurrentPage.setText(curPage);</div><div class="line">                &#125;</div></pre></td></tr></table></figure></p>
<p>上一页事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">if (curPage.equals(&quot;1&quot;)) &#123;</div><div class="line">                    Toast.makeText(this, &quot;首页&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">                &#125; else &#123;</div><div class="line">                    curPage = &quot;&quot; + (Integer.parseInt(curPage) - 1);</div><div class="line"></div><div class="line">                    if (curPage.equals(1)) &#123;</div><div class="line">                        url = &quot;http://www.dianping.com/search/category/2/45&quot;;</div><div class="line">                    &#125; else &#123;</div><div class="line"></div><div class="line">                        url = &quot;http://www.dianping.com&quot; + mMapList.get(Integer.parseInt(curPage) - 1).get(&quot;url&quot;).toString();</div><div class="line">                    &#125;</div><div class="line">                    switchOver();</div><div class="line">                    tvCurrentPage.setText(curPage);</div><div class="line">                &#125;</div></pre></td></tr></table></figure>
<p>经过小编测试，在点击下一页的时候没有bug，在点击上一页的时候，会出现doc为null，从而奔溃的bug，小编在努力解决中，但还没解决掉。</p>
<ol>
<li>附上完整的runnable代码，毕竟这是此程序的关键部分。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">Runnable runnable = new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            Connection conn = Jsoup.connect(url);</div><div class="line">            // 修改http包中的header,伪装成浏览器进行抓取</div><div class="line">            conn.header(&quot;User-Agent&quot;, userAgent);</div><div class="line">            Document doc = null;</div><div class="line">            try &#123;</div><div class="line">                doc = conn.get();</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            // 获取页数的链接</div><div class="line">            if (firstLoad) &#123;</div><div class="line">                Elements elementsPages = doc.getElementsByClass(&quot;content-wrap&quot;);</div><div class="line">                Elements elementsPageA = elementsPages.first().getElementsByClass(&quot;shop-wrap&quot;).first().child(1).getElementsByTag(&quot;a&quot;);</div><div class="line">                for (int i = 0; i &lt; elementsPageA.size() - 2; i++) &#123;</div><div class="line">                    Element element = elementsPageA.get(i);</div><div class="line">                    Element element1 = element.getElementsByClass(&quot;cur&quot;).first();</div><div class="line">                    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</div><div class="line">                    if (element1 != null) &#123;</div><div class="line">                        curPage = element1.text();</div><div class="line">                        map.put(&quot;page&quot;, &quot;&quot; + (i + 1));</div><div class="line">                        map.put(&quot;url&quot;, url);</div><div class="line">                        mMapList.add(map);</div><div class="line">                    &#125; else &#123;</div><div class="line">                        map.put(&quot;page&quot;, &quot;&quot; + (i + 1));</div><div class="line">                        map.put(&quot;url&quot;, element.attr(&quot;href&quot;));</div><div class="line">                        mMapList.add(map);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            firstLoad = false;</div><div class="line">            //获取场馆的数据</div><div class="line">            Element elementDiv = doc.getElementById(&quot;shop-all-list&quot;);</div><div class="line">            Elements elementsUl = elementDiv.getElementsByTag(&quot;ul&quot;);</div><div class="line">            Elements elements = elementsUl.first().getElementsByTag(&quot;li&quot;);</div><div class="line">            for (Element element : elements) &#123;</div><div class="line">                Elements elements1 = element.children();</div><div class="line">                String targetUrl = elements1.get(0).getElementsByTag(&quot;a&quot;).attr(&quot;href&quot;);</div><div class="line"></div><div class="line">                String img = elements1.get(0).getElementsByTag(&quot;img&quot;).first().attr(&quot;data-src&quot;);</div><div class="line">                if (img.contains(&quot;.jpg&quot;)) &#123;</div><div class="line">                    int a = img.indexOf(&quot;.jpg&quot;);</div><div class="line">                    img = img.substring(0, a + 4);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                String radiumName = elements1.get(1).child(0).getElementsByTag(&quot;h4&quot;).text();</div><div class="line">                String address0 = elements1.get(1).child(2).getElementsByTag(&quot;a&quot;).get(1).text();</div><div class="line"></div><div class="line">                String address1 = elements1.get(1).child(2).getElementsByClass(&quot;addr&quot;).text();</div><div class="line">//                StringBuilder stringBuilder = new StringBuilder();</div><div class="line">//</div><div class="line">//                if (elements1.get(2).child(0).children().size()&gt;0)&#123;</div><div class="line">//                    String  youhui = &quot;&quot;;</div><div class="line">//                    if (!&quot;&quot;.equals(elements1.get(2).child(0).child(0).getElementsByClass(&quot;more&quot;).text()))&#123;</div><div class="line">//                        youhui = elements1.get(2).child(0).getElementsByTag(&quot;a&quot;).get(1).attr(&quot;title&quot;);</div><div class="line">//                    &#125;else &#123;</div><div class="line">//                        youhui = elements1.get(2).child(0).getElementsByTag(&quot;a&quot;).get(1).attr(&quot;title&quot;);</div><div class="line">//</div><div class="line">//                    &#125;</div><div class="line">//</div><div class="line">//                    stringBuilder.append(youhui+&quot;+++&quot;);</div><div class="line">//                &#125;</div><div class="line">                RadiumBean radiumBean = new RadiumBean();</div><div class="line">                radiumBean.setTargetUrl(&quot;http://www.dianping.com&quot; + targetUrl);</div><div class="line">                radiumBean.setImg(img);</div><div class="line">                radiumBean.setName(radiumName);</div><div class="line">                radiumBean.setAddress(address0 + &quot; &quot; + address1);</div><div class="line">                list.add(radiumBean);</div><div class="line">            &#125;</div><div class="line">            // 执行完毕后给handler发送一个空消息</div><div class="line">            Message message = new Message();</div><div class="line">            message.arg1 = Integer.parseInt(curPage);</div><div class="line">            handler.sendMessage(message);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<p>有不明白的可以对照完整的runnable代码来理解。</p>
<h3 id="通过上面的步骤，我们已经完成了抓取、加载、上下页切换的效果。但但请看下面。"><a href="#通过上面的步骤，我们已经完成了抓取、加载、上下页切换的效果。但但请看下面。" class="headerlink" title="通过上面的步骤，我们已经完成了抓取、加载、上下页切换的效果。但但请看下面。"></a>通过上面的步骤，我们已经完成了抓取、加载、上下页切换的效果。但但请看下面。</h3><p>通过小编的切身体验，发现jsoup爬虫获取数据时候的几个需要注意的地方。</p>
<ol>
<li>个人要会js，再强调一遍，不会js，上面我写的js的程序应该会非常的迷糊，即便会的人，因为每个人写的也不一样，也是不好看懂的。</li>
<li>我们在爬取数据的时候所用的class  id 等字段一旦发生变化，那就得不到相应的标签了，页面就会发生奔溃，这一点也是致命的一点把。</li>
<li>要想非常逼真的实现网页中的效果，那你就要好好的看看网页的源代码了，网页代码有很大的灵活性，需要你仔细分析记录规律。</li>
</ol>
<h3 id="测试程序已经上传到了github，有需要的可以下载源程序。"><a href="#测试程序已经上传到了github，有需要的可以下载源程序。" class="headerlink" title="测试程序已经上传到了github，有需要的可以下载源程序。"></a>测试程序已经上传到了github，有需要的可以下载源程序。</h3><p>下载地址：<a href="https://github.com/201216323/TestAndroidCrawler" target="_blank" rel="external">点我点我点我</a></p>
<p>欢迎访问201216323.tech来查看我的CSDN博客。</p>
<p>欢迎关注我的个人技术公众号,快速查看我的最新文章。</p>
<p><img src="http://img.blog.csdn.net/20161220174646569?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2NnXzIwMTIxNjMyMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="我的公众号图片" title="bruce常"></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://201216323.tech/2017/09/05/网络爬虫技术Jsoup——爬到一切你想要的/" data-id="cj77fb4310019hksgnbjutu31" class="article-share-link">分享</a><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a href="/2017/09/05/经受时间沉淀的15-个-Android-通用流行框架大全/" class="pre">经受时间沉淀的15 个 Android 通用流行框架大全</a><a href="/2017/09/05/2：Android5-0中Material-Dialog、SwipeRefreshLayout等控件的使用。/" class="next"> 2：Android5.0中Material Dialog、SwipeRefreshLayout等控件的使用。</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://201216323.tech"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/经受时间沉淀的15-个-Android-通用流行框架大全/">经受时间沉淀的15 个 Android 通用流行框架大全</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/网络爬虫技术Jsoup——爬到一切你想要的/">网络爬虫技术Jsoup——爬到一切你想要的</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/2：Android5-0中Material-Dialog、SwipeRefreshLayout等控件的使用。/"> 2：Android5.0中Material Dialog、SwipeRefreshLayout等控件的使用。</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/1：Android5-0中TextInputLayout和Snackbar的使用。/"> 1：Android5.0中TextInputLayout和Snackbar的使用。</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/28/18：Python3-模块/">18：Python3-模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/27/17：Python3-数据结构/">17：Python3 数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/27/16：Python3-函数/">16：Python3 函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/27/15：Python3-迭代器与生成器/">15：Python3 迭代器与生成器</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/27/14：Python3-循环语句/">14：Python3 循环语句</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/27/13：Python3-条件控制/">13：Python3 条件控制</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">常灿光个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>