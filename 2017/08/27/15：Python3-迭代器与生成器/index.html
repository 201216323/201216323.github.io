<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="好记性不如烂笔头，多看多写多分享。"><title>15：Python3 迭代器与生成器 | 常灿光个人博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">15：Python3 迭代器与生成器</h1><a id="logo" href="/.">常灿光个人博客</a><p class="description">常灿光</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">15：Python3 迭代器与生成器</h1><div class="post-meta">Aug 27, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><p>迭代是Python最强大的功能之一，是访问集合元素的一种方式。</p>
<p>迭代器是一个可以记住遍历的位置的对象。</p>
<p>迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退。</p>
<p>迭代器有两个基本的方法：iter()和next()。</p>
<p>字符串、列表或者元组对象都可以创建迭代器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; list = [1,2,3,4]</div><div class="line">&gt;&gt;&gt; it = iter(list)</div><div class="line">&gt;&gt;&gt; print(next(it))</div><div class="line">1</div><div class="line">&gt;&gt;&gt;</div><div class="line">&gt;&gt;&gt; print(next(it))</div><div class="line">2</div><div class="line">&gt;&gt;&gt; print(next(it))</div><div class="line">3</div><div class="line">&gt;&gt;&gt; print(next(it))</div><div class="line">4</div><div class="line">&gt;&gt;&gt; print(next(it))</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</div><div class="line">StopIteration</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>
<p>迭代器对象可以使用常规for语句进行遍历。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python3</div><div class="line"></div><div class="line">list = [1,2,3,4]</div><div class="line">it = iter(list)</div><div class="line">for  x in it:</div><div class="line">   print(x,end=&quot; &quot;)</div></pre></td></tr></table></figure>
<p>执行以上程序，输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1 2 3 4</div></pre></td></tr></table></figure>
<p>也可以使用 next() 函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python3</div><div class="line">import sys      # 引入 sys 模块</div><div class="line">list = [1,2,3,4]</div><div class="line">it = iter(list)   # 创建迭代器对象</div><div class="line">print(next(it))</div><div class="line">print(next(it))</div><div class="line">print(next(it))</div><div class="line">print(next(it))</div></pre></td></tr></table></figure>
<p>执行以上程序，输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td></tr></table></figure>
<h1 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h1><p>在Python中，使用了yield的函数被称为生成器(generator)。</p>
<p>跟普通函数不同的是，生成器是一个返回迭代器的函数，只能用于迭代操作，更简单点理解生成器就是一个迭代器。</p>
<p>在调用生成器运行的过程中，每次遇到yield时，函数会暂停并保存当前所有的运行信息，返回yield的值。并在下一次执行next()方法时从当前位置继续运行。</p>
<p>以下实例使用yield实现斐波那契数列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python3</div><div class="line">import sys  # 引入 sys 模块</div><div class="line"></div><div class="line"></div><div class="line">def fibnnacci(n):  # 生成器函数--斐波那契</div><div class="line">    a, b, counter = 0, 1, 0</div><div class="line">    while True:</div><div class="line">        if (counter &gt; n):</div><div class="line">            return</div><div class="line">        yield a</div><div class="line"></div><div class="line">        a, b = b, a + b</div><div class="line">        counter += 1</div><div class="line"></div><div class="line"></div><div class="line">f = fibnnacci(10)  # f是一个迭代器，由生成器返回生成</div><div class="line"></div><div class="line">while True:</div><div class="line">    try:</div><div class="line">        print(next(f), end=&quot; &quot;)</div><div class="line">    except StopIteration:</div><div class="line">        sys.exit()</div></pre></td></tr></table></figure>
<p>执行以上程序，输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0 1 1 2 3 5 8 13 21 34 55</div></pre></td></tr></table></figure>
<p><strong>备注：</strong></p>
<p>来看一下有yield和没有yield的情况会对生成器有更多的了解：</p>
<p><strong>第一种：使用yield</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python3</div><div class="line">import sys  # 引入 sys 模块</div><div class="line"></div><div class="line"></div><div class="line">def fibnnacci(n):  # 生成器函数--斐波那契</div><div class="line">    a, b, counter = 0, 1, 0</div><div class="line">    while True:</div><div class="line">        if (counter &gt; n):</div><div class="line">            return</div><div class="line">        yield a</div><div class="line">        a, b = b, a + b</div><div class="line">        print(&apos;%d,%d&apos; % (a,b))</div><div class="line">        counter += 1</div><div class="line"></div><div class="line"></div><div class="line">f = fibnnacci(10)  # f是一个迭代器，由生成器返回生成</div><div class="line"></div><div class="line">while True:</div><div class="line">    try:</div><div class="line">        print(next(f), end=&quot; &quot;)</div><div class="line">    except StopIteration:</div><div class="line">        sys.exit()</div></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">0 1,1</div><div class="line">1 1,2</div><div class="line">1 2,3</div><div class="line">2 3,5</div><div class="line">3 5,8</div><div class="line">5 8,13</div><div class="line">8 13,21</div><div class="line">13 21,34</div><div class="line">21 34,55</div><div class="line">34 55,89</div><div class="line">55 89,144</div></pre></td></tr></table></figure>
<p><strong>第一种：不使用yield</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python3</div><div class="line">import sys  # 引入 sys 模块</div><div class="line"></div><div class="line"></div><div class="line">def fibnnacci(n):  # 生成器函数--斐波那契</div><div class="line">    a, b, counter = 0, 1, 0</div><div class="line">    while True:</div><div class="line">        if (counter &gt; n):</div><div class="line">            return</div><div class="line">        # yield a</div><div class="line">        a, b = b, a + b</div><div class="line">        print(&apos;%d,%d&apos; % (a,b))</div><div class="line">        counter += 1</div><div class="line"></div><div class="line"></div><div class="line">f = fibnnacci(10)  # f是一个迭代器，由生成器返回生成</div><div class="line"></div><div class="line">while True:</div><div class="line">    try:</div><div class="line">        print(next(f), end=&quot; &quot;)</div><div class="line">    except :</div><div class="line">        sys.exit()</div></pre></td></tr></table></figure></p>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1,1</div><div class="line">1,2</div><div class="line">2,3</div><div class="line">3,5</div><div class="line">5,8</div><div class="line">8,13</div><div class="line">13,21</div><div class="line">21,34</div><div class="line">34,55</div><div class="line">55,89</div><div class="line">89,144</div></pre></td></tr></table></figure>
<p>第二种没有yield时候，函数只是简单执行，没有返回迭代器f。这里的迭代器可以用生成l列表来理解一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; l = [i for i in range(0,15)]</div><div class="line">&gt;&gt;&gt; print(l)</div><div class="line">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</div><div class="line">&gt;&gt;&gt; m = (i for i in range(0,15))</div><div class="line">&gt;&gt;&gt; print(m)</div><div class="line">&lt;generator object &lt;genexpr&gt; at 0x104b6f258&gt;</div><div class="line">&gt;&gt;&gt; for g in m:</div><div class="line">...     print(g,end=&apos;, &apos;)</div><div class="line">... </div><div class="line">0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,</div></pre></td></tr></table></figure>
<p>这里的m就像上面的f一样，是迭代器。</p>
<p><strong>什么情况下需要使用yield???</strong></p>
<p>一个函数f ，f返回一个list，这个list是动态计算出来的(不管是数学上的计算还是逻辑上的读取格式化)，并且这个list会很大（无论是固定很大还是随着输入参数的增大而增大），这个时候，我们希望每次调用这个函数并使用迭代器进行循环的时候，一个一个的得到每个list元素，而不是直接得到一个完整的list来节省内存，这个时候yield就很有用。</p>
<p>以斐波那契函数为例，我们一般希望从 n 返回一个 n 个数的 list：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">def fab(max): </div><div class="line">   n, a, b = 0, 0, 1 </div><div class="line">   L = [] </div><div class="line">   while n &lt; max: </div><div class="line">       L.append(b) </div><div class="line">       a, b = b, a + b </div><div class="line">       n = n + 1 </div><div class="line">   return L</div></pre></td></tr></table></figure></p>
<p>上面那个 fab 函数从参数 max 返回一个有 max 个元素的 list，当这个 max 很大的时候，会非常的占用内存。</p>
<p>一般我们使用的时候都是这个样子的，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">f = fab(1000)</div><div class="line">while True:</div><div class="line">    try:</div><div class="line">        print (next(f), end=&quot; &quot;)</div><div class="line">    except StopIteration:</div><div class="line">        sys.exit()</div></pre></td></tr></table></figure></p>
<p>这样我们实际上是先生成了一个1000个元素的list:f，然后我们再去使用这个 f。现在，我们换一个方法：</p>
<p>因为我们实际使用的是 list 的遍历，也就是 list 的迭代器。那么我们可以让这个函数 fab 每次只返回一个迭代器——一个计算结果，而不是一个完整的 list：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def fab(max): </div><div class="line">    n, a, b = 0, 0, 1 </div><div class="line">    while n &lt; max: </div><div class="line">        yield b </div><div class="line">        # print b </div><div class="line">        a, b = b, a + b </div><div class="line">        n = n + 1</div></pre></td></tr></table></figure></p>
<p>这样，我们每次调用fab函数，比如这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for x in fab(1000):</div><div class="line">	print(x)</div></pre></td></tr></table></figure></p>
<p>或者 next 函数之类的，实际上的运行方式是每次的调用都在 yield 处中断并返回一个结果，然后再次调用的时候再恢复中断继续运行。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://201216323.tech/2017/08/27/15：Python3-迭代器与生成器/" data-id="cj7e6ngn1000350sgz3yb2s3p" class="article-share-link">分享</a><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a href="/2017/08/27/16：Python3-函数/" class="pre">16：Python3 函数</a><a href="/2017/07/27/14：Python3-循环语句/" class="next">14：Python3 循环语句</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://201216323.tech"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Html5/" style="font-size: 15px;">Html5</a> <a href="/tags/友盟/" style="font-size: 15px;">友盟</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/熟练使用Android-Studio，亲自体验，持续更新。/">熟练使用Android Studio，亲自体验，持续更新。</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/MVP设计模式的一次深入探索和优化/">MVP设计模式的一次深入探索和优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/JNI开发-一点一点搞清楚NDK开发的步骤/">JNI开发----一点一点搞清楚NDK开发的步骤</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/JNI开发-复习曾经学习过的C语言/">JNI开发----复习曾经学习过的C语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/过去的2016，期待的2017，我与北京继续相伴。/">过去的2016，期待的2017，我与北京继续相伴。</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/事件总线之EventBus/">事件总线之EventBus</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/图片加载框架之Fresco/">图片加载框架之Fresco</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/图片加载框架之Picasso/">图片加载框架之Picasso</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/图片加载框架之Glide/">图片加载框架之Glide</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/个人收藏的一些很有性价比的Github链接/">个人收藏的一些很有性价比的Github链接</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">常灿光个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>